<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vagas - If(Conecta)</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/vagas.css">
  <link rel="stylesheet" href="/css/notifications.css">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script src="/js/quill.js"></script>
</head>

<body>
  <%- include('partials/header') %>

    <div class="container job-list-container">
      <div class="job-list-header">
        <h1 class="job-list-title">Vagas</h1>

        <input type="text" id="jobSearchInput" placeholder="Buscar vagas..." class="input input-search" />

        <div class="filters">
          <select id="contractTypeFilter" class="input">
            <option value="">Todos os tipos de contrato</option>
            <option value="estagio">Estágio</option>
            <option value="clt">CLT</option>
            <option value="pj">PJ</option>
            <option value="freelance">Freelance</option>
            <option value="temporario">Temporário</option>
          </select>

          <select id="requirementFilter" class="input">
            <option value="">Todos os requisitos</option>
            <% // Pega todos os requisitos únicos para preencher o filtro %>
              <% const allRequirements=new Set(); jobs.forEach(job=> {
                job.requirements?.forEach(req => allRequirements.add(req.name));
                });
                [...allRequirements].forEach(req => {
                %>
                <option value="<%= req.toLowerCase() %>">
                  <%= req %>
                </option>
                <% }); %>
          </select>
        </div>


      </div>


      <% if (isEmployer) { %>
        <a href="/jobs/create" class="btn btn-primary">Criar Nova Vaga</a>
        <% } %>
    </div>

    <% if (error) { %>
      <div class="alert alert-danger">
        <%= error %>
      </div>
      <% } %>

        <% if (isStudent) { %>
          <!-- Abas para estudantes -->
          <div class="job-tabs">
            <a href="/jobs/list?filter=open" class="job-tab <%= filter === 'open' ? 'active' : '' %>">
              Vagas abertas

            </a>
            <a href="/jobs/list?filter=closed" class="job-tab <%= filter === 'closed' ? 'active' : '' %>">
              Vagas encerradas

            </a>
            <a href="/jobs/list?filter=applied" class="job-tab <%= filter === 'applied' ? 'active' : '' %>">
              Vagas que estou candidato


            </a>

            <a href="/jobs/list?filter=all" class="job-tab <%= filter === 'all' ? 'active' : '' %>">
              Todas vagas

            </a>
          </div>
          <% } %>

            <div class="jobs-container">
              <% if (jobs.length===0) { %>
                <div class="alert alert-info">
                  Nenhuma vaga encontrada.
                </div>
                <% } else { %>
                  <% jobs.forEach(job=> { %>
                    <div class="job-card" data-title="<%= job.title.toLowerCase() %>"
                      data-description="<%= job.description.toLowerCase() %>"
                      data-contracttype="<%= job.contractType ? job.contractType.toLowerCase() : '' %>"
                      data-requirements="<%= job.requirements && job.requirements.length > 0 ? job.requirements.map(r => r.name.toLowerCase()).join(', ') : '' %>">

                      <div class="job-card-header">
                        <h2 class="job-card-title">
                          <%= job.title %>
                        </h2>
                        <div class="job-status <%= job.status ? 'open' : 'closed' %>">
                          <%= job.status ? 'Aberta' : 'Encerrada' %>
                        </div>
                      </div>
                      <div class="job-card-body">
                        <div class="job-card-company">
                          <% if (job.employer && job.employer.photo) { %>
                            <img src="/uploads/<%= job.employer.photo %>" alt="<%= job.employer.name %>">
                            <% } else { %>
                              <img src="/uploads/foto_padrao.png" alt="Empresa">
                              <% } %>
                                <span>
                                  <%= job.employer ? job.employer.name : 'Empresa' %>
                                </span>
                        </div>




                        <% if (job.requirements && job.requirements.length> 0) { %>
                          <div class="job-card-requirements">
                            <h3 class="job-card-requirements-title">Requisitos:</h3>
                            <div class="badges-container">
                              <% job.requirements.forEach(req=> { %>
                                <span class="badge" data-badge-name="<%= req.name %>">
                                  <i class="badge-icon-svg" data-feather="code"></i>
                                  <%= req.name %>
                                </span>
                                <% }) %>
                            </div>
                          </div>
                          <% } %>

                            <div class="mt-3">
                              <div class="job-card-meta">
                                <div class="job-card-meta-item">
                                  <i data-feather="briefcase"></i>
                                  <span>
                                    <%= job.contractType %>
                                  </span>
                                </div>
                              </div>
                              <a href="/jobs/<%= job.id %>" class="btn btn-primary">Ver detalhes</a>
                            </div>
                      </div>

                      <div class="job-card-footer">
                        <div class="job-card-date">
                          <%= new Date(job.createdAt).toLocaleDateString('pt-BR') %>
                        </div>



                        <% if (isEmployer && job.applications) { %>
                          <div class="job-card-applications">
                            <i data-feather="users"></i>
                            <span>
                              <%= job.applications.length %> candidato(s)
                            </span>
                          </div>
                          <% } %>
                      </div>
                    </div>
                    <% }) %>
                      <% } %>
            </div>
            </div>

            <%- include('partials/footer') %>

</body>

</html>

<script src="/js/jobSearch.js"></script>
<script src="/js/main.js"></script>
<script src="/js/notifications.js"></script>