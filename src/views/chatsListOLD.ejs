<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meus Chats - If(Conecta)</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/chat.css">
  <link rel="stylesheet" href="/css/notifications.css">
</head>

<body>
  <%- include('partials/header') %>

    <main class="container">
      <h2>Meus Chats</h2>

      <div class="chats-container">
        <% if (chats && chats.length> 0) { %>
          <div class="chats-list">
            <% chats.forEach(chat=> { %>
              <a href="/chat/<%= chat.id %>"
                class="chat-item <%= chat.unreadCount > 0 ? 'unread' : '' %> <%= chat.status === 'CLOSED' ? 'closed' : '' %>">
                <div class="chat-item-user">
                  <% if (userType==='employer' || (userType==='admin' && chat.student)) { %>
                    <% if (chat.student && chat.student.photo) { %>
                      <img src="/uploads/<%= chat.student.photo %>" alt="<%= chat.student.name %>"
                        class="chat-user-photo">
                      <% } else if (chat.student) { %>
                        <div class="chat-user-photo-placeholder">
                          <%= chat.student.name.charAt(0).toUpperCase() %>
                        </div>
                        <% } %>
                          <div>
                            <h3>
                              <%= chat.student ? chat.student.name : 'Usuário' %>
                            </h3>
                            <p class="chat-job-title">
                              <% if (chat.job) { %>
                                Vaga: <%= chat.job.title %>
                                  <% } else { %>
                                    Chat administrativo
                                    <% } %>
                            </p>
                          </div>
                          <% } else { %>
                            <% if (chat.employer && chat.employer.photo) { %>
                              <img src="/uploads/<%= chat.employer.photo %>" alt="<%= chat.employer.name %>"
                                class="chat-user-photo">
                              <% } else if (chat.employer) { %>
                                <div class="chat-user-photo-placeholder">
                                  <%= chat.employer.name.charAt(0).toUpperCase() %>
                                </div>
                                <% } %>
                                  <div>
                                    <h3>
                                      <%= chat.employer ? chat.employer.name : 'Usuário' %>
                                    </h3>
                                    <p class="chat-job-title">
                                      <% if (chat.job) { %>
                                        Vaga: <%= chat.job.title %>
                                          <% } else { %>
                                            Chat administrativo
                                            <% } %>
                                    </p>
                                  </div>
                                  <% } %>
                </div>

                <div class="chat-item-preview">
                  <% if (chat.messages && chat.messages.length> 0) { %>
                    <p class="chat-last-message">
                      <%= chat.messages[0].content.length> 50 ? chat.messages[0].content.substring(0, 50) + '...' :
                        chat.messages[0].content %>
                    </p>
                    <p class="chat-time">
                      <%= new Date(chat.messages[0].createdAt).toLocaleDateString() %>
                    </p>
                    <% } else { %>
                      <p class="chat-last-message">Nenhuma mensagem ainda</p>
                      <% } %>

                        <% if (chat.unreadCount> 0) { %>
                          <span class="chat-unread-count">
                            <%= chat.unreadCount %>
                          </span>
                          <% } %>

                            <% if (chat.status==='CLOSED' ) { %>
                              <span class="chat-status-badge closed">Encerrado</span>
                              <% } %>
                </div>
              </a>
              <% }) %>
          </div>
          <% } else { %>
            <div class="no-chats">
              <p>Você ainda não tem nenhum chat.</p>
              <% if (userType==='student' ) { %>
                <p>Candidate-se a vagas para que os empregadores possam iniciar um chat com você.</p>
                <a href="/jobs/list" class="btn primary-btn">Ver Vagas Disponíveis</a>
                <% } else if (userType==='employer' ) { %>
                  <p>Inicie um chat com candidatos às suas vagas.</p>
                  <a href="/jobs/list" class="btn primary-btn">Ver Minhas Vagas</a>
                  <% } else { %>
                    <p>Você pode iniciar chats com estudantes ou empregadores.</p>
                    <% } %>
            </div>
            <% } %>
      </div>
    </main>

    <%- include('partials/footer') %>

      <script src="/js/main.js"></script>
      <script src="/js/notifications.js"></script>
</body>

</html>